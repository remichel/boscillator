---
title: "introduction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Installation

tba 

# Load package

```{r setup}
library(boscillator)
```

# First steps

Let's simulate a simple experiment and plot the time courses.
```{r simulation}
# simulate experiment data
bosc = simulate_experiment(transient = "exponential")

# plot simulations
library(ggplot2)
ggplot(NULL)+
  geom_line(data = bosc$data$ss$real$data, aes(x = time, y = hr, group = subj, color = subj), linetype = "dashed")+
  geom_line(data = bosc$data$ga$real$data, aes(x = time, y = hr), size = 2)+
  theme_classic()+
  theme(legend.position = "none")

```


# Create surrogate datasets

We can create surrogates using `generate_surrogates`.

```{r surrogates}

# generate surrogates
bosc = generate_surrogates(bosc)

# plot simulation and surrogates for a single subject
ggplot(NULL)+
  geom_line(data = bosc$data$ss$real$data %>% filter(subj == 2),
            aes(x = time, y = hr), color = "black", size = 3) +
  geom_line(data = bosc$data$ss$surrogate$data %>% filter(subj == 2),
            aes(x = time, y = hr, group = n_surr, color = n_surr))+
  theme(legend.position = "none")

# plot grand average simulations and its surrogates
ggplot(NULL)+
  geom_line(data = bosc$data$ga$real$data, aes(x = time, y = hr), color = "black", size = 3) +
  geom_line(data = bosc$data$ga$surrogate$data, aes(x = time, y = hr, group = n_surr, color = n_surr))+
  theme(legend.position = "none")

```

# Preprocess data

We can use the functions `detrend_bosc`, `scale_bosc`, `windowing_bosc` and `padding_bosc` to preprocess our data.

```{r preproc}

bosc = detrend_bosc(bosc, order = 2)

bosc = window_bosc(bosc, method = "hann")

bosc = pad_bosc(bosc, method = "zero")

bosc = scale_bosc(bosc, method = "z")

ggplot(bosc$data$ss$real$data, aes(x = time, y = hr, group = subj))+
  geom_line(aes(color = subj))

```

# FFT and Test

We can use `fft_bosc`and `test_fft` to check for significant rhythms.

```{r fft}

# fft
bosc = fft_bosc(bosc)

# with Bonferroni correction for the number of frequency bins
bosc = test_fft(bosc, alpha = .05/length(unique(bosc$data$ga$real$fft$f)))

ggplot(bosc$test$fft$ga, aes(x = f, y = observed))+
  geom_line()+
  geom_line(aes(y = crit_value), linetype = "dashed")

ggplot(bosc$test$fft$ss, aes(x = f, y = observed, group = subj))+
  geom_line(aes(color = subj))+
  geom_line(aes(y = crit_value, color = subj), linetype = "dashed")

```

```{r full pipeline}

bosc = simulate_experiment(transient = "exponential")
bosc = generate_surrogates(bosc)

bosc = detrend_bosc(bosc, order = 2)
bosc = scale_bosc(bosc, method = "z")
bosc = window_bosc(bosc, method = "hann")
bosc = pad_bosc(bosc, method = "zero")

bosc = fft_bosc(bosc)
bosc = test_fft(bosc, alpha = .05)



```
